<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="de">

<head>
    <title>Qr-Gate - Ticket Shop</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/main.css') }}">
    <noscript>
        <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/noscript.css') }}">
    </noscript>

    <style>
        .popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.8);
    padding: 20px;
    border-radius: 10px;
    color: white;
    z-index: 10000;
}

.popup-content {
    text-align: center;
}

.close {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #ccc;
    text-decoration: none;
    cursor: pointer;
}
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* Hintergrundfarbe mit Transparenz */
            z-index: 9999;
            /* Stacking Context über anderen Inhalten */
        }

        /* CSS für die Ladeanimation */
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            /* Animation */
            z-index: 10000;
            /* Über dem Overlay */
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .success-icon,
        .error-icon {
            color: white;
            font-size: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            /* Über dem Overlay */
        }

        .success-icon {
            color: rgb(3, 146, 3);
            background-color: #1c1c1c;
        }

        .error-icon {
            color: rgb(185, 3, 3);
            background-color: #1c1c1c;
        }
    </style>

</head>

<body class="is-preload">
    <div id="overlay" class="overlay">
        <div class="loader"></div>
    </div>
    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Header -->
        <header id="header">
            <div class="logo">
                <span class="icon fa-gem"></span>
            </div>
            <div class="content">
                <div class="inner">
                    <h1>Willkommen!</h1>
                    <p>Herzlich willkommen im Ticket Shop von {{ config.company_name }}! Hier kannst du dir Tickets für die Nächste Vorstellung reservieren.</p>

                </div>
            </div>
            <div id="popup" class="popup">
                <div class="popup-content">
                    <span class="close" onclick="closePopup()">&times;</span>
                    <p>Der Shop ist im Moment gesperrt!</p>
                </div>
            </div>

            <nav>
                <ul>
                    <li><a href="#tickets">Tickets</a></li>
                    <li><a href="#about">About</a></li>
                    <!--<li><a href="#elements">Elements</a></li>-->
                </ul>
            </nav>
        </header>

        <!-- Main -->
        <div id="main">

            <!-- Intro -->
            <article id="aboutus">
                <h2 class="major">Intro</h2>
                <span class="image main"><img src="{{ url_for('static', filename='images/pic01.jpg') }}"
                        alt="Bild"></span>
                <p></p>
            </article>

            <!-- Work -->
            <article id="tickets">
                <h2 class="major">Tickets</h2>
                <span class="image main"><img src="{{ url_for('static', filename='images/pic02.jpg') }}"
                        alt="Bild"></span>
                <p>Hier kannst du dir Tickets für die nächste Vorstellung reservieren.</p>
                <form method="post" action="/API/get_tickets">
                    <div class="fields">
                        <div class="field">
                            <label for="name">Name</label>
                            <input type="text" name="name" id="name" value="" placeholder="Jane Doe" required />
                        </div>
                        <div class="field">
                            <label for="email">Email</label>
                            <input type="email" name="email" id="email" value="" placeholder="jane@example.com"
                                required />
                        </div>
                        <div class="field">
                            <label for="personcount">Personenanzahl</label>
                            <select name="personcount" id="personcount" required>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="field">
                            <label for="date">Datum</label>
                            <select name="date" id="date" required>
                                <option value="">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                    </div>
                    <ul class="actions">
                        <li><input type="submit" value="Ticket(s) reservieren" class="primary" /></li>
                        <li><input type="reset" value="Reset" /></li>
                    </ul>
                </form>
            </article>

            <!-- About -->
            <article id="about">
                <h2 class="major">About</h2>
                <span class="image main"><img src="{{ url_for('static', filename='images/pic03.jpg') }}"
                        alt="Bild"></span>
                <p>Lorem ipsum dolor sit amet, consectetur et adipiscing elit. Praesent eleifend dignissim arcu, at
                    eleifend sapien imperdiet ac. Aliquam erat volutpat. Praesent urna nisi, fringila lorem et vehicula
                    lacinia quam. Integer sollicitudin mauris nec lorem luctus ultrices. Aliquam libero et malesuada
                    fames ac ante ipsum primis in faucibus. Cras viverra ligula sit amet ex mollis mattis lorem ipsum
                    dolor sit amet.</p>
            </article>

        </div>

        <!-- Footer -->
        <footer id="footer">
            <p class="copyright">&copy; Qr-Gate</a>.</p>
        </footer>

    </div>

    <!-- BG -->
    <div id="bg"></div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='assets/js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/browser.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/breakpoints.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/util.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/main.js') }}"></script>

<script>
    $(document).ready(function () {
        $('form').submit(function (event) {
            event.preventDefault();  // Verhindert das Standardverhalten des Formulars

            // Zeigen Sie das Overlay mit der Ladeanimation an
            $('#overlay').show();

            // Bestimmen Sie den Ziel-Endpunkt basierend auf dem ausgelösten Formular
            var endpoint = $(this).attr('action');

            // Fügen Sie hier die Logik zur Überprüfung des Werts hinzu, bevor das Ticket gesendet wird
            fetch('/API/shopbarrier_get')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch shopbarrier status');
                    }
                    return response.json();
                })
                .then(data => {
                    // Überprüfen, ob der Wert 1 ist
                    if (data.value === 1) {
                        // Zeigen Sie das Popup an und brechen Sie den Ticketversand ab
                        $('#overlay').hide();
                        alert('Ticket Reservierung Gesperrt')
                    } else {
                        // Wenn der Wert nicht 1 ist, senden Sie das Ticket wie gewohnt
                        $.ajax({
                            type: 'POST',
                            url: endpoint,
                            data: $(this).serialize(),  // Senden Sie Formulardaten
                            success: function (data) {
                                // Verstecken Sie das Overlay nach erfolgreicher Aktion und zeigen Sie das Erfolgs-Icon an
                                $('#overlay').hide();
                                $('body').append('<i class="fa fa-check-circle success-icon"></i>');
                                alert("Ticket reserviert! Dir wird in kürze eine E-Mail zugesendet!")
                                // Nach 3 Sekunden die Seite neu laden
                                setTimeout(function () {
                                    $('i.error-icon, i.success-icon').remove();
                                }, 3000);
                            },
                            error: function (xhr, status, error) {
                                // Verstecken Sie das Overlay
                                $('#overlay').hide();

                                // Überprüfen Sie, ob das Fehlerobjekt zusätzliche Informationen enthält
                                if (xhr.responseJSON) {
                                    // Zeigen Sie die Fehlermeldung in einem Alert-Fenster an
                                    alert(Object.values(xhr.responseJSON).join('\n'));
                                } else {
                                    // Zeigen Sie den vollständigen Fehler in der Konsole an
                                    console.error(xhr.responseText);
                                }

                                // Nach 3 Sekunden die Seite neu laden
                                setTimeout(function () {
                                    $('i.error-icon, i.success-icon').remove();
                                }, 3000);
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error('Error: ' + error.message);
                    // Bei einem Fehler das Overlay ausblenden
                    $('#overlay').hide();
                });
        });
    });
</script>


</body>

</html>